<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test – Simbolismul în Europa și în România</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;margin:0;padding:24px;background:#f6f8fa;color:#111827;display:flex;justify-content:center}
    .container{width:100%;max-width:900px;background:#fff;border-radius:10px;box-shadow:0 6px 18px rgba(15,23,42,0.08);padding:28px}
    h1{margin:0 0 8px;font-size:22px}p.lead{margin:0 0 18px;color:#4b5563}
    .q{margin-bottom:16px;padding:10px;border-radius:8px}
    .q.correct{background:#ecfdf5;border:1px solid #bbf7d0}
    .q.wrong{background:#fff1f2;border:1px solid #fecaca}
    .q label{display:block;font-weight:700;margin-bottom:6px}
    .opts{display:flex;flex-direction:column;gap:6px}
    input[type="text"],input[type="email"],textarea{width:100%;box-sizing:border-box;padding:10px 12px;border:1px solid #d1d5db;border-radius:6px;font-size:15px}
    .actions{display:flex;gap:12px;align-items:center;margin-top:18px;flex-wrap:wrap}
    button{background:#2563eb;color:#fff;border:none;padding:10px 14px;border-radius:8px;cursor:pointer;font-weight:600}
    button.secondary{background:#e5e7eb;color:#111827}
    .small{font-size:13px;color:#6b7280}
    .error{color:#dc2626;font-size:13px;margin-top:6px}
    #resultBox{margin-top:22px;padding:14px;border-radius:8px;background:#f8fafc;border:1px solid #e6eefc}
    #adminRoot{margin-top:22px;padding-top:12px;border-top:1px dashed #e6eefc}
    .muted{color:#6b7280;font-size:13px}
    .correctMark{color:green;font-weight:700;margin-left:8px}
    .wrongMark{color:#b91c1c;font-weight:700;margin-left:8px}
    .explanation{margin-top:8px;padding:10px;background:#ffffff;border-radius:6px;border:1px solid #eef2ff;font-size:14px}
    .reviewBtn{background:#10b981}
  </style>
</head>
<body>
  <main class="container" role="main">
    <h1>Test – Simbolismul în Europa și în România</h1>
    <p class="lead">Răspunde la întrebări. Toate întrebările sunt obligatorii.</p>

    <form id="testForm" autocomplete="on" novalidate>
      <!-- întrebările -->
      <div class="q" data-q="1" id="q1">
        <label>1. Simbolismul este un curent literar apărut:</label>
        <div class="opts">
          <label><input type="radio" name="q1" value="a" required> a) În Antichitate</label>
          <label><input type="radio" name="q1" value="b"> b) În Evul Mediu</label>
          <label><input type="radio" name="q1" value="c"> c) În a doua jumătate a secolului al XIX-lea</label>
          <label><input type="radio" name="q1" value="d"> d) În secolul XXI</label>
        </div>
      </div>

      <div class="q" data-q="2" id="q2">
        <label>2. Simbolismul pune accent pe:</label>
        <div class="opts">
          <label><input type="radio" name="q2" value="a" required> a) Povestire și acțiune</label>
          <label><input type="radio" name="q2" value="b"> b) Sugestie și simbol</label>
          <label><input type="radio" name="q2" value="c"> c) Descriere realistă</label>
          <label><input type="radio" name="q2" value="d"> d) Umor</label>
        </div>
      </div>

      <div class="q" data-q="3" id="q3">
        <label>3. Care este forma literară preferată de simboliști?</label>
        <div class="opts">
          <label><input type="radio" name="q3" value="a" required> a) Romanul</label>
          <label><input type="radio" name="q3" value="b"> b) Nuvela</label>
          <label><input type="radio" name="q3" value="c"> c) Poezia</label>
          <label><input type="radio" name="q3" value="d"> d) Drama</label>
        </div>
      </div>

      <div class="q" data-q="4" id="q4">
        <label>4. Muzicalitatea este importantă în simbolism deoarece:</label>
        <div class="opts">
          <label><input type="radio" name="q4" value="a" required> a) Face poezia mai distractivă</label>
          <label><input type="radio" name="q4" value="b"> b) Ajută la exprimarea emoțiilor</label>
          <label><input type="radio" name="q4" value="c"> c) Înlocuiește simbolurile</label>
          <label><input type="radio" name="q4" value="d"> d) Clarifică mesajul direct</label>
        </div>
      </div>

      <div class="q" data-q="5" id="q5">
        <label>5. Care dintre următoarele teme este specifică simbolismului?</label>
        <div class="opts">
          <label><input type="radio" name="q5" value="a" required> a) Eroismul istoric</label>
          <label><input type="radio" name="q5" value="b"> b) Melancolia și tristețea</label>
          <label><input type="radio" name="q5" value="c"> c) Viața satului</label>
          <label><input type="radio" name="q5" value="d"> d) Aventurile</label>
        </div>
      </div>

      <div class="q" data-q="6" id="q6">
        <label>6. Un simbol des întâlnit în poezia simbolistă este:</label>
        <div class="opts">
          <label><input type="radio" name="q6" value="a" required> a) Lumina puternică</label>
          <label><input type="radio" name="q6" value="b"> b) Culorile reci și sunetele</label>
          <label><input type="radio" name="q6" value="c"> c) Personajul istoric</label>
          <label><input type="radio" name="q6" value="d"> d) Dialogul</label>
        </div>
      </div>

      <div class="q" data-q="7" id="q7">
        <label>7. Care dintre următorii scriitori este reprezentant al simbolismului european?</label>
        <div class="opts">
          <label><input type="radio" name="q7" value="a" required> a) Johann Wolfgang Goethe</label>
          <label><input type="radio" name="q7" value="b"> b) Charles Baudelaire</label>
          <label><input type="radio" name="q7" value="c"> c) Ion Creangă</label>
          <label><input type="radio" name="q7" value="d"> d) Liviu Rebreanu</label>
        </div>
      </div>

      <div class="q" data-q="8" id="q8">
        <label>8. Simbolismul românesc este influențat în principal de:</label>
        <div class="opts">
          <label><input type="radio" name="q8" value="a" required> a) Literatura germană</label>
          <label><input type="radio" name="q8" value="b"> b) Literatura franceză</label>
          <label><input type="radio" name="q8" value="c"> c) Literatura rusă</label>
          <label><input type="radio" name="q8" value="d"> d) Literatura italiană</label>
        </div>
      </div>

      <div class="q" data-q="9" id="q9">
        <label>9. Care dintre următoarele trăsături este comună simbolismului european și românesc?</label>
        <div class="opts">
          <label><input type="radio" name="q9" value="a" required> a) Narațiunea obiectivă</label>
          <label><input type="radio" name="q9" value="b"> b) Descrierea realistă</label>
          <label><input type="radio" name="q9" value="c"> c) Atmosfera de neliniște și sugestie</label>
          <label><input type="radio" name="q9" value="d"> d) Accentul pe acțiune</label>
        </div>
      </div>

      <div class="q" data-q="10" id="q10">
        <label>10. Poetul român care exprimă cel mai bine simbolismul prin atmosfera apăsătoare și cromatică este:</label>
        <div class="opts">
          <label><input type="radio" name="q10" value="a" required> a) Lucian Blaga</label>
          <label><input type="radio" name="q10" value="b"> b) Mihai Eminescu</label>
          <label><input type="radio" name="q10" value="c"> c) George Bacovia</label>
          <label><input type="radio" name="q10" value="d"> d) Vasile Alecsandri</label>
        </div>
      </div>

      <hr>

      <div class="q">
        <label for="nume">Nume complet *</label>
        <input id="nume" name="nume" type="text" placeholder="Ex: Ion Popescu" required>
        <div id="err-nume" class="error" aria-live="polite"></div>
      </div>

      <div class="q">
        <label for="email">Email *</label>
        <input id="email" name="email" type="email" placeholder="exemplu@domeniu.com" required>
        <div id="err-email" class="error" aria-live="polite"></div>
      </div>

      <div class="actions">
        <button type="submit">Trimite testul</button>
        <button type="button" class="secondary" id="resetBtn">Resetează</button>
        <button type="button" class="reviewBtn" id="reviewBtn">Revizuire</button>
        <div class="small" id="status" aria-live="polite"></div>
      </div>
    </form>

    <div id="resultBox" hidden>
      <h2>Rezultat</h2>
      <div id="scoreLine" class="muted"></div>
      <div id="details"></div>
      <div class="explanation" id="allExplanations"></div>
    </div>

    <div id="adminRoot" aria-live="polite"></div>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import {
      getFirestore, collection, addDoc, query, getDocs, orderBy, deleteDoc, doc
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // Config integrat
    const firebaseConfig = {
      apiKey: "AIzaSyCWA4CvL_xRPow_6UEhtvU3Ctl-_y6p_ts",
      authDomain: "chestionar-f8774.firebaseapp.com",
      projectId: "chestionar-f8774",
      storageBucket: "chestionar-f8774.firebasestorage.app",
      messagingSenderId: "702271518390",
      appId: "1:702271518390:web:5731631890a9cfd4e21817",
      measurementId: "G-YSL672F1NC"
    };
    const ADMIN_UID = "9QIRYBqMRmQUhU4fVJdsVFI66Fe2";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Key: corecte pentru fiecare întrebare
    const ANSWERS = {
      q1: 'c',
      q2: 'b',
      q3: 'c',
      q4: 'b',
      q5: 'b',
      q6: 'b',
      q7: 'b',
      q8: 'b',
      q9: 'c',
      q10: 'c'
    };

    // explicații pentru fiecare întrebare
    const EXPLANATIONS = {
      q1: 'Simbolismul s-a dezvoltat în a doua jumătate a secolului al XIX-lea, ca reacție la realism și naturalism.',
      q2: 'Simbolismul pune accent pe sugestie, imagini și simboluri care evocă stări interioare, nu pe descriere directă.',
      q3: 'Poezia este forma preferată a simboliștilor, deoarece permite concizia imagistică și sonoră.',
      q4: 'Muzicalitatea ajută la exprimarea emoțiilor și la crearea atmosferei, fiind esențială în poezia simbolistă.',
      q5: 'Melancolia și tristețea sunt teme frecvente în simbolism, reflectând preocuparea pentru stările interioare.',
      q6: 'Culorile reci și sunetele sunt folosite frecvent ca simboluri sugestive în poezia simbolistă.',
      q7: 'Charles Baudelaire este unul dintre principalii precursori ai simbolismului în Europa.',
      q8: 'Simbolismul românesc a fost influențat în principal de literatura franceză și de curentele pariziene.',
      q9: 'Atmosfera de neliniște și sugestie este o trăsătură comună simbolismului european și românesc.',
      q10: 'George Bacovia exprimă atmosfera apăsătoare și cromatica caracteristică simbolismului românesc.'
    };

    // util
    function validateEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }
    function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;').replaceAll("'",'&#39;').replaceAll('\n','<br>'); }

    // Formular
    (function(){
      const form = document.getElementById('testForm');
      const status = document.getElementById('status');
      const resetBtn = document.getElementById('resetBtn');
      const reviewBtn = document.getElementById('reviewBtn');
      const resultBox = document.getElementById('resultBox');
      const scoreLine = document.getElementById('scoreLine');
      const details = document.getElementById('details');
      const allExplanations = document.getElementById('allExplanations');

      function clearErrors(){
        document.getElementById('err-nume').textContent = '';
        document.getElementById('err-email').textContent = '';
      }

      function markReview(responses){
        for(let i=1;i<=10;i++){
          const qid = 'q'+i;
          const wrapper = document.getElementById(qid);
          wrapper.classList.remove('correct','wrong');
          const r = responses[qid];
          if(r && r.correct) wrapper.classList.add('correct'); else wrapper.classList.add('wrong');
          // adăugăm etichete vizibile
          let marker = wrapper.querySelector('.marker');
          if(!marker){
            marker = document.createElement('div'); marker.className = 'marker'; marker.style.marginTop='8px';
            wrapper.appendChild(marker);
          }
          marker.innerHTML = r && r.correct ? '<span class="correctMark">Corect</span>' : '<span class="wrongMark">Greșit</span>';
        }
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        clearErrors();
        status.textContent = '';

        const name = form.nume.value.trim();
        const email = form.email.value.trim();

        if(!name){ document.getElementById('err-nume').textContent = 'Completează numele.'; return; }
        if(!validateEmail(email)){ document.getElementById('err-email').textContent = 'Email invalid.'; return; }

        // colectăm răspunsurile și calculăm scorul
        const responses = {};
        let score = 0;
        for(let i=1;i<=10;i++){
          const key = 'q'+i;
          const el = form.querySelector(`[name="${key}"]:checked`);
          const val = el ? el.value : null;
          const correct = ANSWERS[key];
          const ok = val === correct;
          if(ok) score++;
          responses[key] = { answer: val, correct: ok };
        }

        // afișare rezultat la client
        resultBox.hidden = false;
        scoreLine.textContent = `${escapeHtml(name)} — ${escapeHtml(email)} • Scor: ${score} / 10`;
        details.innerHTML = '';
        for(let i=1;i<=10;i++){
          const k='q'+i;
          const r=responses[k];
          const correctLetter = ANSWERS[k];
          const correctText = form.querySelector(`[name="${k}"][value="${correctLetter}"]`).parentElement.textContent.trim();
          const givenText = r.answer ? form.querySelector(`[name="${k}"][value="${r.answer}"]`).parentElement.textContent.trim() : 'N/A';
          const cls = r.correct ? 'correctMark' : 'wrongMark';
          details.innerHTML += `<div style="margin-bottom:6px"><strong>Întrebarea ${i}:</strong> Răspuns ales: ${escapeHtml(givenText)} — <span class="${cls}">${r.correct ? 'Corect' : 'Greșit'}</span><br><em>Răspuns corect:</em> ${escapeHtml(correctText)}</div>`;
        }

        // afișăm explicațiile
        let exHtml = '<strong>Explicații:</strong>';
        for(let i=1;i<=10;i++){
          const k='q'+i;
          exHtml += `<div style="margin-top:8px"><strong>${i}.</strong> ${escapeHtml(EXPLANATIONS[k])}</div>`;
        }
        allExplanations.innerHTML = exHtml;

        // marcăm revizuirea automat
        markReview(responses);

        // pregătim obiectul pentru Firestore
        const payload = {
          timestamp: new Date().toISOString(),
          name,
          email,
          score,
          total: 10,
          responses // obiect cu fiecare întrebare: {answer, correct}
        };

        // trimitem la Firestore (colecția schimbată la "Chestionar")
        try {
          await addDoc(collection(db, "Chestionar"), payload);
          status.textContent = 'Test trimis și înregistrat.';
        } catch (err) {
          console.error('Firestore write error', err);
          status.textContent = 'Eroare la trimitere.';
        }

      });

      // buton revizuire: marchează corect/greșit (fără a trimite)
      reviewBtn.addEventListener('click', (e) =>{
        e.preventDefault();
        const responses = {};
        for(let i=1;i<=10;i++){
          const key='q'+i;
          const el = form.querySelector(`[name="${key}"]:checked`);
          const val = el ? el.value : null;
          const ok = val === ANSWERS[key];
          responses[key] = { answer: val, correct: ok };
        }
        markReview(responses);
        // afișăm explicațiile scurte
        let exHtml = '<strong>Explicații (revizuire):</strong>';
        for(let i=1;i<=10;i++){
          exHtml += `<div style="margin-top:8px"><strong>${i}.</strong> ${escapeHtml(EXPLANATIONS['q'+i])}</div>`;
        }
        allExplanations.innerHTML = exHtml;
        resultBox.hidden = false;
        scoreLine.textContent = `Revizuire locală • Rezultate afișate (neînregistrate)`;
      });

      resetBtn.addEventListener('click', () => {
        form.reset();
        resultBox.hidden = true;
        clearErrors();
        status.textContent = 'Formular resetat.';
        // curățăm markere
        for(let i=1;i<=10;i++){
          const wrapper = document.getElementById('q'+i);
          wrapper.classList.remove('correct','wrong');
          const marker = wrapper.querySelector('.marker');
          if(marker) marker.remove();
        }
        allExplanations.innerHTML = '';
      });
    })();

    // Admin area (login + vedere răspunsuri)
    (function(){
      const adminRoot = document.getElementById('adminRoot');
      adminRoot.innerHTML = `
        <h2>Admin — autentificare și răspunsuri</h2>
        <div id="authArea">
          <div id="loginBox" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            <input id="adminEmail" type="email" placeholder="Email admin" style="padding:8px;border:1px solid #ccc;border-radius:6px" />
            <input id="adminPass" type="password" placeholder="Parolă" style="padding:8px;border:1px solid #ccc;border-radius:6px" />
            <button id="loginBtn" style="padding:8px 12px">Login</button>
            <div id="authMsg" class="muted" style="margin-left:8px"></div>
          </div>
          <div id="adminControls" style="display:none;margin-top:12px">
            <button id="logoutBtn" class="secondary" style="padding:8px 12px">Logout</button>
          </div>
        </div>
        <div id="adminArea" style="display:none;margin-top:12px">
          <h3>Răspunsuri primite</h3>
          <div id="responsesList" style="max-height:420px;overflow:auto;border:1px solid #eee;padding:8px;border-radius:6px;background:#fafafa"></div>
        </div>
      `;

      const loginBtn = document.getElementById('loginBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      const authMsg = document.getElementById('authMsg');
      const adminArea = document.getElementById('adminArea');
      const responsesList = document.getElementById('responsesList');

      loginBtn.addEventListener('click', async () => {
        const email = document.getElementById('adminEmail').value;
        const pass = document.getElementById('adminPass').value;
        authMsg.textContent = '';
        try {
          await signInWithEmailAndPassword(auth, email, pass);
          authMsg.textContent = 'Autentificare...';
        } catch (err) {
          console.error('Login error', err);
          authMsg.textContent = 'Eroare autentificare.';
        }
      });

      logoutBtn.addEventListener('click', async () => {
        try{ await signOut(auth); } catch(e){ console.error(e); }
      });

      onAuthStateChanged(auth, async (user) => {
        if(user){
          if(user.uid !== ADMIN_UID){
            authMsg.textContent = 'Acces interzis pentru acest cont.';
            await signOut(auth);
            return;
          }
          document.getElementById('loginBox').style.display = 'none';
          document.getElementById('adminControls').style.display = 'block';
          adminArea.style.display = 'block';
          authMsg.textContent = '';
          await loadResponses();
        } else {
          document.getElementById('loginBox').style.display = 'flex';
          document.getElementById('adminControls').style.display = 'none';
          adminArea.style.display = 'none';
        }
      });

      async function loadResponses(){
        responsesList.innerHTML = 'Se încarcă...';
        try {
          const q = query(collection(db, "Chestionar"), orderBy("timestamp","desc"));
          const snap = await getDocs(q);
          if(snap.empty){ responsesList.innerHTML = '<div class="muted">Niciun test încă.</div>'; return; }
          const out = [];
          snap.forEach(docSnap => {
            const d = docSnap.data();
            const id = docSnap.id;
            let repHtml = `<div style="border-bottom:1px solid #eee;padding:8px 0">
              <div><strong>${escapeHtml(d.name||'Anonim')}</strong> <span class="muted">(${new Date(d.timestamp).toLocaleString()})</span></div>
              <div style="font-size:14px"><em>Email:</em> ${escapeHtml(d.email||'-')}</div>
              <div style="margin-top:6px"><strong>Scor:</strong> ${d.score} / ${d.total}</div>
              <div style="margin-top:6px">`;
            // list answers
            for(let i=1;i<=10;i++){
              const k='q'+i;
              const r = d.responses?.[k] || {};
              const ans = r.answer || '-';
              const ok = r.correct ? 'Corect' : 'Greșit';
              repHtml += `<div style="font-size:13px;margin-top:4px"><strong>${i}.</strong> ${escapeHtml(ans)} — <span class="${r.correct? 'correctMark':'wrongMark'}">${ok}</span></div>`;
            }
            repHtml += `</div><div style="margin-top:6px"><button data-id="${id}" class="delBtn" style="padding:6px 8px;background:#fee2e2;border-radius:6px;border:1px solid #fca5a5">Șterge</button></div></div>`;
            out.push(repHtml);
          });
          responsesList.innerHTML = out.join('');
          document.querySelectorAll('.delBtn').forEach(btn=>{
            btn.addEventListener('click', async (ev)=>{
              const id = ev.target.getAttribute('data-id');
              try {
                await deleteDoc(doc(db, "Chestionar", id));
                await loadResponses();
              } catch(err){ console.error('Delete error', err); alert('Eroare la ștergere.'); }
            });
          });
        } catch (err) {
          console.error('Load responses error', err);
          responsesList.innerHTML = 'Eroare la încărcare.';
        }
      }
    })();
  </script>
</body>
</html>
